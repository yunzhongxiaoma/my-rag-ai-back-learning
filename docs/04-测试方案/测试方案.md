# 测试方案文档

## 1. 测试策略概述

### 1.1 测试目标
- 确保系统功能完整性和正确性
- 验证系统性能指标满足需求
- 保障系统安全性和稳定性
- 验证向量数据库迁移的有效性
- 确保RAG问答系统的准确性

### 1.2 测试原则
- **全面覆盖**：覆盖所有核心功能和业务场景
- **风险驱动**：重点测试高风险和核心业务功能
- **自动化优先**：优先实现自动化测试，提高测试效率
- **持续集成**：集成到CI/CD流程中，确保代码质量
- **数据驱动**：使用真实数据进行测试验证

## 2. 测试类型和范围

### 2.1 单元测试 (Unit Testing)

#### 2.1.1 测试范围
- Service层业务逻辑测试
- Util工具类功能测试
- DAO层数据访问测试
- 算法和核心逻辑测试

#### 2.1.2 测试工具
- **JUnit 5**：Java单元测试框架
- **Mockito**：Mock对象框架
- **TestContainers**：集成测试容器
- **AssertJ**：断言库

#### 2.1.3 覆盖率要求
- 代码覆盖率 ≥ 80%
- 分支覆盖率 ≥ 70%
- 核心业务逻辑覆盖率 ≥ 90%

### 2.2 集成测试 (Integration Testing)

#### 2.2.1 测试范围
- 数据库集成测试
- 第三方服务集成测试
- 模块间接口集成测试
- 向量数据库集成测试

#### 2.2.2 测试环境
- 使用TestContainers启动测试数据库
- Mock第三方服务接口
- 独立的测试数据集

### 2.3 接口测试 (API Testing)

#### 2.3.1 测试范围
- RESTful API功能测试
- 参数验证测试
- 权限控制测试
- 异常处理测试

#### 2.3.2 测试工具
- **Spring Boot Test**：Spring Boot测试框架
- **MockMvc**：Web层测试
- **Postman/Newman**：API自动化测试
- **RestAssured**：REST API测试库

### 2.4 性能测试 (Performance Testing)

#### 2.4.1 测试类型
- **负载测试**：验证系统在预期负载下的性能
- **压力测试**：确定系统的最大承载能力
- **稳定性测试**：长时间运行的稳定性验证
- **并发测试**：多用户并发访问测试

#### 2.4.2 测试工具
- **JMeter**：性能测试工具
- **Gatling**：高性能负载测试工具
- **Artillery**：现代化负载测试工具

#### 2.4.3 性能指标
- 响应时间：问答接口 < 5秒，文档上传 < 30秒
- 吞吐量：支持100并发用户
- 资源使用：CPU < 80%，内存 < 85%
- 错误率：< 1%

### 2.5 安全测试 (Security Testing)

#### 2.5.1 测试范围
- 身份认证和授权测试
- 输入验证和SQL注入测试
- XSS和CSRF防护测试
- 敏感数据保护测试

#### 2.5.2 测试工具
- **OWASP ZAP**：Web应用安全扫描
- **SonarQube**：代码安全分析
- **Burp Suite**：Web安全测试

## 3. 测试用例设计

### 3.1 用户管理模块测试用例

#### 3.1.1 用户注册功能测试
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_USER_001 | 正常注册 | 有效用户名、密码、邮箱 | 注册成功，返回用户信息 | 高 |
| TC_USER_002 | 用户名重复 | 已存在的用户名 | 注册失败，提示用户名已存在 | 高 |
| TC_USER_003 | 密码格式错误 | 弱密码（少于6位） | 注册失败，提示密码格式错误 | 中 |
| TC_USER_004 | 邮箱格式错误 | 无效邮箱格式 | 注册失败，提示邮箱格式错误 | 中 |
| TC_USER_005 | 必填字段为空 | 用户名为空 | 注册失败，提示必填字段不能为空 | 高 |

#### 3.1.2 用户登录功能测试
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_LOGIN_001 | 正常登录 | 正确用户名和密码 | 登录成功，返回JWT Token | 高 |
| TC_LOGIN_002 | 用户名错误 | 不存在的用户名 | 登录失败，提示用户名或密码错误 | 高 |
| TC_LOGIN_003 | 密码错误 | 错误的密码 | 登录失败，提示用户名或密码错误 | 高 |
| TC_LOGIN_004 | 账户被禁用 | 被禁用的账户 | 登录失败，提示账户已被禁用 | 中 |
| TC_LOGIN_005 | Token有效性 | 有效Token访问接口 | 正常访问受保护资源 | 高 |

### 3.2 文档管理模块测试用例

#### 3.2.1 文档上传功能测试
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_DOC_001 | PDF文档上传 | 有效PDF文件 | 上传成功，状态为PROCESSING | 高 |
| TC_DOC_002 | Word文档上传 | 有效DOCX文件 | 上传成功，状态为PROCESSING | 高 |
| TC_DOC_003 | 文本文档上传 | 有效TXT文件 | 上传成功，状态为PROCESSING | 中 |
| TC_DOC_004 | 不支持格式 | 图片文件 | 上传失败，提示文件格式不支持 | 中 |
| TC_DOC_005 | 文件过大 | 超过100MB的文件 | 上传失败，提示文件过大 | 中 |
| TC_DOC_006 | 空文件上传 | 0字节文件 | 上传失败，提示文件不能为空 | 低 |

#### 3.2.2 文档处理功能测试
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_PROC_001 | 文档解析 | 包含文本的PDF | 成功提取文本内容 | 高 |
| TC_PROC_002 | 文档分块 | 长文本文档 | 按规则分块，保持语义完整性 | 高 |
| TC_PROC_003 | 向量化处理 | 文本分块 | 生成向量并存储到Milvus | 高 |
| TC_PROC_004 | 处理状态更新 | 处理完成的文档 | 状态更新为COMPLETED | 中 |
| TC_PROC_005 | 异常处理 | 损坏的文档 | 状态更新为FAILED，记录错误信息 | 中 |

### 3.3 智能问答模块测试用例

#### 3.3.1 问答功能测试
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_QA_001 | 基础问答 | 简单问题 | 返回相关答案和引用文档 | 高 |
| TC_QA_002 | 复杂问答 | 需要推理的问题 | 基于文档内容进行推理回答 | 高 |
| TC_QA_003 | 无关问题 | 文档中没有的内容 | 明确说明文档中无相关信息 | 中 |
| TC_QA_004 | 多轮对话 | 上下文相关问题 | 结合对话历史回答 | 中 |
| TC_QA_005 | 空问题 | 空字符串 | 提示问题不能为空 | 低 |

#### 3.3.2 向量检索测试
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_VEC_001 | 精确匹配 | 文档中的原文 | 返回高相似度结果 | 高 |
| TC_VEC_002 | 语义匹配 | 同义词查询 | 返回语义相关结果 | 高 |
| TC_VEC_003 | 模糊匹配 | 部分关键词 | 返回相关度排序结果 | 中 |
| TC_VEC_004 | 阈值过滤 | 低相关度查询 | 过滤低相似度结果 | 中 |
| TC_VEC_005 | 批量检索 | 多个查询 | 正确处理批量请求 | 低 |

### 3.4 系统集成测试用例

#### 3.4.1 端到端流程测试
| 用例ID | 测试场景 | 测试步骤 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_E2E_001 | 完整RAG流程 | 注册→登录→上传文档→等待处理→问答 | 整个流程正常完成 | 高 |
| TC_E2E_002 | 多用户并发 | 多用户同时上传和问答 | 系统正常处理，无数据混乱 | 高 |
| TC_E2E_003 | 大文档处理 | 上传大型PDF文档 | 成功处理并可正常问答 | 中 |
| TC_E2E_004 | 系统恢复 | 服务重启后 | 数据完整，功能正常 | 中 |

## 4. 测试环境配置

### 4.1 测试环境架构
```
测试环境架构：
┌─────────────────────────────────────────────────────────────┐
│                    测试环境 (Docker Compose)                  │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │
│  │ Spring Boot │ │   MySQL     │ │   Milvus    │ │  Redis  │ │
│  │    App      │ │  Test DB    │ │  Test DB    │ │ Test DB │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────┘ │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────┐ │
│  │   JMeter    │ │  Postman    │ │  SonarQube  │ │ Jenkins │ │
│  │ (性能测试)   │ │ (接口测试)   │ │ (代码质量)   │ │ (CI/CD) │ │
│  └─────────────┘ └─────────────┘ └─────────────┘ └─────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 环境配置要求

#### 4.2.1 硬件配置
- **CPU**：4核心以上
- **内存**：8GB以上
- **存储**：50GB可用空间
- **网络**：稳定的网络连接

#### 4.2.2 软件配置
- **操作系统**：Linux/Windows/macOS
- **Docker**：20.10+
- **Docker Compose**：2.0+
- **JDK**：17
- **Maven**：3.9+

### 4.3 测试数据准备

#### 4.3.1 基础测试数据
```sql
-- 测试用户数据
INSERT INTO tb_user (username, password, nickname, email, role) VALUES
('testuser1', '$2a$10$encrypted_password', '测试用户1', 'test1@example.com', 'USER'),
('testuser2', '$2a$10$encrypted_password', '测试用户2', 'test2@example.com', 'USER'),
('admin', '$2a$10$encrypted_password', '管理员', 'admin@example.com', 'ADMIN');

-- 测试文档数据
INSERT INTO doc_document (user_id, file_name, original_name, file_path, file_size, file_type, status) VALUES
(1, 'test_doc_1.pdf', '测试文档1.pdf', '/test/path/1.pdf', 1024000, 'PDF', 'COMPLETED'),
(1, 'test_doc_2.docx', '测试文档2.docx', '/test/path/2.docx', 512000, 'DOCX', 'COMPLETED'),
(2, 'test_doc_3.txt', '测试文档3.txt', '/test/path/3.txt', 256000, 'TXT', 'PROCESSING');
```

#### 4.3.2 向量测试数据
- 准备不同类型的文档样本（PDF、Word、文本）
- 包含中英文混合内容
- 涵盖不同领域的知识内容
- 准备标准问答对用于验证准确性

### 4.4 测试环境部署脚本

#### 4.4.1 Docker Compose配置
```yaml
# docker-compose.test.yml
version: '3.8'
services:
  mysql-test:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: test123
      MYSQL_DATABASE: rag_test
    ports:
      - "3307:3306"
    volumes:
      - ./test-data/mysql:/docker-entrypoint-initdb.d

  milvus-test:
    image: milvusdb/milvus:v2.5.5
    command: ["milvus", "run", "standalone"]
    environment:
      ETCD_ENDPOINTS: etcd-test:2379
      MINIO_ADDRESS: minio-test:9000
    ports:
      - "19531:19530"
    depends_on:
      - etcd-test
      - minio-test

  redis-test:
    image: redis:7-alpine
    ports:
      - "6380:6379"
```

## 5. 缺陷管理流程

### 5.1 缺陷分类标准

#### 5.1.1 严重程度分级
- **致命 (Critical)**：系统崩溃、数据丢失、安全漏洞
- **严重 (Major)**：核心功能无法使用、性能严重下降
- **一般 (Minor)**：功能部分异常、用户体验问题
- **轻微 (Trivial)**：界面显示问题、文档错误

#### 5.1.2 优先级分级
- **P0 (紧急)**：立即修复，阻塞测试进行
- **P1 (高)**：当前版本必须修复
- **P2 (中)**：下个版本修复
- **P3 (低)**：后续版本考虑修复

### 5.2 缺陷处理流程

#### 5.2.1 缺陷发现和报告
1. **缺陷发现**：测试人员在测试过程中发现问题
2. **缺陷记录**：在缺陷管理系统中创建缺陷记录
3. **缺陷分类**：确定严重程度和优先级
4. **缺陷分配**：分配给相应的开发人员

#### 5.2.2 缺陷修复和验证
1. **开发修复**：开发人员分析并修复缺陷
2. **修复验证**：测试人员验证修复效果
3. **回归测试**：确保修复不影响其他功能
4. **缺陷关闭**：验证通过后关闭缺陷

### 5.3 缺陷报告模板

#### 5.3.1 缺陷报告格式
```
缺陷ID: BUG-2024-001
标题: 文档上传后处理状态未正确更新
严重程度: Major
优先级: P1
发现人: 测试工程师
发现时间: 2024-01-07 10:30:00

环境信息:
- 操作系统: Windows 11
- 浏览器: Chrome 120.0
- 服务器版本: v1.0.0

重现步骤:
1. 登录系统
2. 上传PDF文档
3. 等待处理完成
4. 查看文档状态

预期结果: 文档状态应更新为COMPLETED
实际结果: 文档状态仍显示为PROCESSING

附件: 错误截图、日志文件
```

## 6. 测试报告和度量

### 6.1 测试执行报告

#### 6.1.1 测试执行统计
- **测试用例总数**：记录设计的测试用例总数
- **执行用例数**：记录实际执行的测试用例数
- **通过用例数**：记录测试通过的用例数
- **失败用例数**：记录测试失败的用例数
- **阻塞用例数**：记录因环境问题无法执行的用例数

#### 6.1.2 缺陷统计分析
- **缺陷总数**：按严重程度和优先级统计
- **缺陷分布**：按模块和功能点分布
- **缺陷趋势**：缺陷发现和修复趋势
- **缺陷密度**：每千行代码的缺陷数

### 6.2 质量度量指标

#### 6.2.1 功能质量指标
- **功能覆盖率**：测试覆盖的功能点比例
- **需求覆盖率**：测试覆盖的需求比例
- **用例通过率**：测试用例通过的比例
- **缺陷修复率**：缺陷修复的比例

#### 6.2.2 性能质量指标
- **响应时间**：各接口的平均响应时间
- **吞吐量**：系统的处理能力
- **并发用户数**：支持的最大并发用户数
- **资源利用率**：CPU、内存、磁盘使用率

### 6.3 测试总结报告

#### 6.3.1 测试结论
- **测试完成情况**：测试执行的完整性
- **质量评估**：系统质量的整体评估
- **风险评估**：识别的质量风险和建议
- **发布建议**：是否建议发布的结论

#### 6.3.2 改进建议
- **测试过程改进**：测试流程和方法的改进建议
- **工具和环境**：测试工具和环境的优化建议
- **团队能力**：测试团队能力提升建议
- **质量保障**：质量保障体系的完善建议