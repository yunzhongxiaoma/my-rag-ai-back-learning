# 部署与启动文档

## 1. 环境依赖清单

### 1.1 基础环境要求

#### 1.1.1 硬件要求
| 环境类型 | CPU | 内存 | 存储 | 网络 |
|---------|-----|------|------|------|
| 开发环境 | 4核心 | 8GB | 50GB | 10Mbps |
| 测试环境 | 8核心 | 16GB | 100GB | 100Mbps |
| 生产环境 | 16核心 | 32GB | 500GB | 1Gbps |

#### 1.1.2 操作系统要求
- **支持的操作系统**：Linux (Ubuntu 20.04+, CentOS 8+), Windows 10+, macOS 12+
- **推荐操作系统**：Ubuntu 22.04 LTS
- **容器化支持**：Docker 20.10+, Docker Compose 2.0+

### 1.2 软件依赖清单

#### 1.2.1 核心运行时环境
| 软件名称 | 版本要求 | 必需性 | 说明 |
|---------|----------|--------|------|
| JDK | 17+ | 必需 | Java运行环境 |
| Maven | 3.9+ | 构建时必需 | 项目构建工具 |
| Docker | 20.10+ | 推荐 | 容器化部署 |
| Docker Compose | 2.0+ | 推荐 | 多容器编排 |

#### 1.2.2 数据库和存储服务
| 服务名称 | 版本要求 | 必需性 | 说明 |
|---------|----------|--------|------|
| MySQL | 8.0+ | 必需 | 业务数据存储 |
| Milvus | 2.5+ | 必需 | 向量数据库 |
| Redis | 6.0+ | 必需 | 缓存服务 |
| 阿里云OSS | - | 必需 | 对象存储服务 |

#### 1.2.3 第三方服务
| 服务名称 | 版本要求 | 必需性 | 说明 |
|---------|----------|--------|------|
| 阿里云通义千问 | - | 必需 | 大语言模型服务 |
| MinIO | RELEASE.2023-03-20+ | Milvus依赖 | Milvus对象存储 |
| etcd | v3.5.18+ | Milvus依赖 | Milvus元数据存储 |

### 1.3 网络和端口要求

#### 1.3.1 端口占用清单
| 服务 | 端口 | 协议 | 说明 |
|------|------|------|------|
| Spring Boot应用 | 8989 | HTTP | 主应用服务端口 |
| MySQL | 3306 | TCP | 数据库连接端口 |
| Milvus | 19530 | TCP | 向量数据库服务端口 |
| Milvus管理 | 9091 | HTTP | Milvus健康检查端口 |
| Redis | 6379 | TCP | 缓存服务端口 |
| Attu (可选) | 3000 | HTTP | Milvus管理界面 |
| MinIO | 9000 | HTTP | MinIO API端口 |
| MinIO控制台 | 9001 | HTTP | MinIO管理界面 |
| etcd | 2379 | TCP | etcd客户端端口 |

#### 1.3.2 网络访问要求
- **出站访问**：需要访问阿里云API服务 (dashscope.aliyuncs.com)
- **内网通信**：各服务间需要网络互通
- **防火墙配置**：开放相应端口的访问权限

## 2. 本地开发环境部署

### 2.1 环境准备

#### 2.1.1 安装JDK 17
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install openjdk-17-jdk

# CentOS/RHEL
sudo yum install java-17-openjdk-devel

# macOS (使用Homebrew)
brew install openjdk@17

# Windows
# 下载并安装Oracle JDK 17或OpenJDK 17
```

#### 2.1.2 安装Maven
```bash
# Ubuntu/Debian
sudo apt install maven

# CentOS/RHEL
sudo yum install maven

# macOS
brew install maven

# Windows
# 下载Maven并配置环境变量
```

#### 2.1.3 安装Docker和Docker Compose

### 2.2 数据库服务部署

#### 2.2.1 使用Docker Compose启动数据库服务


#### 2.2.2 MySQL数据库初始化
```bash
# 连接MySQL数据库
mysql -h localhost -P 3306 -u root -p

# 创建数据库
CREATE DATABASE my_rag CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 创建用户并授权
CREATE USER 'rag_user'@'%' IDENTIFIED BY 'rag_password';
GRANT ALL PRIVILEGES ON my_rag.* TO 'rag_user'@'%';
FLUSH PRIVILEGES;
```

#### 2.2.3 Redis服务配置
```bash
# 启动Redis服务
docker run -d --name redis-rag -p 6379:6379 redis:7-alpine

# 测试Redis连接
docker exec -it redis-rag redis-cli ping
```

### 2.3 应用配置

### 2.4 应用启动

#### 2.4.1 编译和打包
```bash
# 清理并编译项目
mvn clean compile

# 运行测试
mvn test

# 打包应用
mvn clean package -DskipTests
```

#### 2.4.2 启动应用
```bash
# 方式1：使用Maven插件启动
mvn spring-boot:run -Dspring-boot.run.profiles=dev

# 方式2：使用Java命令启动
java -jar target/my-rag-ai-back-learning-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev

# 方式3：在IDE中启动
# 在IDE中运行MyRagAiBackLearningApplication.main()方法
```

#### 2.4.3 验证启动
```bash
# 检查应用健康状态
curl http://localhost:8989/actuator/health

# 检查Milvus连接
curl http://localhost:8989/api/system/health

# 查看应用日志
tail -f logs/application.log
```

